# PostgreSQL Client Authentication Configuration File
# ===================================================
#
# This file controls: which hosts are allowed to connect, how clients
# are authenticated, which PostgreSQL user names they can use, which
# databases they can access.

# TYPE  DATABASE        USER            ADDRESS                 METHOD

# Local connections (Unix domain socket)
local   all             postgres                                peer
local   all             all                                     scram-sha-256

# IPv4 local connections
host    all             all             127.0.0.1/32            scram-sha-256

# IPv6 local connections
host    all             all             ::1/128                 scram-sha-256

# Application network connections (Docker network)
# Only allow connections from app_network subnet
host    all             ${DB_USER}      172.21.0.0/16          scram-sha-256
host    all             ${DB_USER}      172.22.0.0/16          scram-sha-256

# Bastion host (maintenance access via VPN)
host    all             postgres        172.23.0.0/16          scram-sha-256

# Deny all other connections
host    all             all             0.0.0.0/0              reject
host    all             all             ::/0                   reject

# Note: Replace ${DB_USER} with your actual database user before deployment
